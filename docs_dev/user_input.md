# user_input.md : ユーザー要求

宇宙ロボット向けミドルウェアSpaceROSに付属するCuriosityローバーデモと、LLMエージェントパッケージのnasa-jpl/rosaを組み合わせたデモを作りたいです。

- [space-ros](https://github.com/space-ros/space-ros)：space-rosの本体。今回使用する仕様的にはほぼROS2と同等と考えて良い（ROS2 Jazzy相当？）
- [demos](https://github.com/space-ros/demos)：SpaceROSのデモ
- [nasa-jpl/rosa](https://github.com/nasa-jpl/rosa)：このパッケージのREADMEの「Adapting ROSA for Your Robot」を実施したい

#### 1. デモの目的（Concept）
- **目的**: 
	- LLMエージェントがフレーム問題の例題を解決するところを見せたい
	- 明示的な手順を与えられていないエージェントが、環境のフィードバック（暗い）とシステム制約（排他制御）を自律的に解釈し、タスクを完遂できるかを検証する。
- **キーメッセージ**: **「無限の『状況×行動』の組み合わせから、LLMが『因果』だけを抽出する。」**

- **フレーム問題**： 有限の処理能力しか持たないエージェントが、複雑な現実世界で行動しようとした際、考慮すべき事象や関係性が無限に発生してしまい、それらを全て記述・推論しようとすると計算量が爆発（または思考停止）してしまう問題。 一般的に、フレーム問題は **「記述の問題」「関連性の問題」「限定の問題」「分岐の問題」** の4つの側面から構成される。

	- **関連性の問題（The Relevance Problem）**： 現在の目的や文脈において、環境に存在する無限の情報や取り得る無数の行動選択肢の中から、**「今まさに目的と関係がある（Relevant）」ものだけをどうやって抽出するか**という問題（認識論的フレーム問題）。
		- **本デモでの位置づけ**：「暗所」という環境要因に対し、無関係な操作（アーム等）を計算対象から除外し、「移動」という解決策だけを常識推論で即座に選定することで、この問題を工学的に回避している。

	- **限定の問題（The Qualification Problem）**： ある行動を成功させるための **「前提条件」や「例外」が論理的に無限に存在**し、それらを事前に全てリストアップしてチェックすることは不可能であるという問題。
		- **本デモでの位置づけ**：「移動」に必要な条件（マストが収納されていること、障害物がないこと、バッテリーがあること…）を全てIf文で記述するのではなく、実行時に発生したエラー（排他制御による拒否）に対して事後的に対処（Recovery）することで、無限の事前チェックを不要にしている。

#### 2. 初期設定と入力（Setup & Input）
- **ユーザー入力**: 
    - `「地面のテクスチャを調査して（Analyze the ground texture）」`
    - ※これ以外のヒント（「移動しろ」「暗い場所がある」等）は一切与えない。
        
- **環境設定（The Hidden Frame）**:
    - **場所**: 初期位置（$X=0$）は日陰（照度不足）。$X \ge 5.0m$ のエリアのみ十分な照度がある。
    - **制約**: マスト展開中（Observation Mode）は移動不可。

#### 3. エージェントへの提供ツール（Tools）

AIには以下の「機能」のみを与え、組み合わせ方は教えない。
- 地面撮影と画質判定。
- マスト旋回による撮影方向の変更。
- 短時間の探索的移動（マスト展開時はエラー）。
- マストの収納（ローバーの移動が可能）
- マストの展開（撮影が可能）
  - Variant A ではマスト関連を無効化する。

#### 4. 想定される創発的挙動（Expected Emergent Behavior）

※AIが推論の結果辿り着くと予測されるルート（テストケース）。

1. **【試行】** エージェントはまず、最もコストの低い「その場での撮影」を試みる → **NG**。
2. **【仮説検証】** 「向きが悪いのか？」と推論し、マストを旋回して方向を変え再度撮影する → **NG**。
3. **【解決策の導出】** 「場所を変えるしかない（移動）」という結論に至る。
4. **【制約の克服】** 移動しようとしてエラーに直面し、`収納`→`移動`→`展開` の手順を自ら組み立てる。
5. **【探索】** グラデーション状の明るさ変化を手がかりに、十分な明るさになるまで移動を繰り返す。
6. **【達成】** 最適な地点でデータを取得し、報告する。

#### 5. システム実装要件（System Requirements）

- **Environment Simulator**:
    - $X$ 座標に応じた明るさ算出
    - 明るさスコアに応じて画像を暗くして、撮影静止画像として別トピックに再パブリッシュ
    - 撮影画像へのスコア焼き込み。
        
- **Visualizer (Rviz)**:
    - ロボットの内部状態（思考・スキャン結果）と、正解エリア（緑色のゾーン）を可視化する。

- Curiosityローバーデモに実装されている、move_forward（nudge）や mast_rotate などをラップしてLLMが使える道具とするラッパー

#### 6. 実行環境要件（Execution Environment） 

- **プラットフォーム**: Windows上の **WSL2 (Ubuntu)**。
- **ランタイム**: Space ROS 公式のデモ用 **Dockerイメージ** を使用する。
    - 想定イメージ:  `space-ros/demos` 相当のもの。
        
- **構成要件**:
    - **GUI表示**: WSLg または X Server を介して、コンテナ内の Gazebo および Rviz がホスト側で正常に描画されること。
    - **ファイル共有**: 開発するPythonスクリプト群（Agent, Visualizer, Simulator）を、Docker Volume または Bind Mount を介してコンテナ内に注入し、実行可能な構成とすること。

---

### Variant A: マスト要素の一部を一時無効化

今回の一次対応として、マスト展開/収納と排他制御を無効化する（mast_rotateは維持）。
フレーム問題の要素は簡略化されるが、明るさ探索に焦点を当てる。
